Name: jmax
Summary: a visual programming environment for real-time, interactive multimedia applications
Version: @VERSION@
Release: 1
Copyright: GPL
Group: Applications/Multimedia
Source: ftp://ftp.ircam.fr/pub/IRCAM/equipes/temps-reel/jmax/releases/jmax-%{version}.tar.gz
BuildRoot: /var/tmp/jmax-%{version}-root
Provides: %{name}-common = %{version}, %{name}-java = %{version}

# gnome and kde menu
%define _gnome_menu_dir /usr/share/gnome/apps/Multimedia
%define _kde_menu_dir /usr/share/applnk/Multimedia

%description
jMax is a visual programming environment for developing real-time, interactive multimedia applications. 


%package common
Summary: Kernel of JMax
Group: Application/Multimedia
%description common
jMax FTS kernel

%package devel
Summary: Header files for jMax
Group: Development/Libraries
Requires: %{name}-common = %{version} 
%description devel
Header files for jMax

%package java
Summary: Java gui for jMax
Group: Applications/Multimedia
Requires: %{name}-common = %{version}
%description java
Java Graphical User Interface for jMax

%package client
Summary: Client for jMax
Group: Applications/Multimedia
%description client
Contains C++ and Python client for jMax

%package jack
Summary: Jack Audio Connection Kit support for jMax
Group: Applications/Multimedia
Requires: jack-audio-connection-kit, %{name}-common = %{version}
%description jack
Jack Audio Connection Kit support for jMax

%prep
%setup -n jmax-%{version}
%build
./configure --with-java=java --with-javac=javac --enable-jack
make

%install
rm -f /var/tmp/rpm.jmax.common.list
rm -f /var/tmp/rpm.jmax.java.list
rm -f /var/tmp/rpm.jmax.global.list
rm -rf $RPM_BUILD_ROOT

make DESTDIR=$RPM_BUILD_ROOT install
# library files for common rpm 
# remove jack to avoid libjack dependency in jmax package and common subpackage
find $RPM_BUILD_ROOT%{_datadir}/jmax/packages -name "lib*.so" | grep -v "jack" | sed "s|$RPM_BUILD_ROOT||g" >> /var/tmp/rpm.jmax.common.list

# jpkg files for common rpm
# remove jack to avoid libjack dependency in jmax package and common subpackage
find $RPM_BUILD_ROOT%{_datadir}/jmax/packages -name "*.jpkg" | grep -v "jack" | sed "s|$RPM_BUILD_ROOT||g" >> /var/tmp/rpm.jmax.common.list

# help files for common rpm
find $RPM_BUILD_ROOT%{_datadir}/jmax/packages -type d -name "help" | sed "s|$RPM_BUILD_ROOT||g" >> /var/tmp/rpm.jmax.common.list
# for java rpm
find $RPM_BUILD_ROOT%{_datadir}/jmax -name "*.jar" | sed "s|$RPM_BUILD_ROOT||g" >> /var/tmp/rpm.jmax.java.list

# for global rpm (without jack support)
cat /var/tmp/rpm.jmax.java.list /var/tmp/rpm.jmax.common.list >> /var/tmp/rpm.jmax.global.list

# gnome menu
mkdir -p $RPM_BUILD_ROOT%{_gnome_menu_dir}
install -c -m 644 ./utils/linux_desktop/%{name}.desktop $RPM_BUILD_ROOT%{_gnome_menu_dir}

#kde menu
mkdir -p $RPM_BUILD_ROOT%{_kde_menu_dir}
install -c -m 644 ./utils/linux_desktop/%{name}.desktop $RPM_BUILD_ROOT%{_kde_menu_dir}

%clean
rm -rf $RPM_BUILD_ROOT

%post

%files -f /var/tmp/rpm.jmax.global.list
%defattr(-, root, root)
%doc LICENCE.fr LICENSE README doc/*
%{_bindir}/jmax
%{_bindir}/fts
%{_libdir}/libfts-%{version}.so
%{_libdir}/libfts.so
%{_kde_menu_dir}/*
%{_gnome_menu_dir}/*

%files common -f /var/tmp/rpm.jmax.common.list
%defattr(-,root,root)
%{_bindir}/fts
%{_libdir}/libfts-%{version}.so
%{_libdir}/libfts.so

%files devel
%defattr(-,root,root)
%{_bindir}/jmax-config
%{_includedir}/fts/*.h
%{_includedir}/fts/packages
%{_libdir}/libfts.la
%{_libdir}/pkgconfig/jmax.pc

%files java -f /var/tmp/rpm.jmax.java.list
%defattr(-,root,root)
%{_bindir}/jmax

%files client
%defattr(-,root,root)
%{_includedir}/fts/client
%{_libdir}/libftsclient.so*
%{_datadir}/jmax/client/python

%files jack
%defattr(-,root,root)
%{_datadir}/jmax/packages/jack

%changelog
* Fri Feb 28 2003 Patrice Tisserand <Patrice.Tisserand@ircam.fr>
- add jMax in KDE and GNOME menus
* Fri Feb  7 2003 Patrice Tisserand <Patrice.Tisserand@ircam.fr>
- remove client C++ headers from devel subpackage
- add jack subpackage building
- remove dependency between jmax and libjack
- add dependency between subpackages
* Thu Feb  6 2003 Patrice Tisserand <Patrice.Tisserand@ircam.fr>
- add building of client sub package
* Thu Nov 21 2002 Patrice Tisserand <Patrice.Tisserand@ircam.fr>
- first set up for multi rpm building

