#!/bin/sh
help ()
{
    cat << HELP_EOF

Usage:
    jmax [-javaopt <java-option>] [-install <installation>] 
	    [-verbose] [<other-jmax-options>]

Starts jMax by running the Java interpreter with the required arguments.

Options and arguments:
  -javaopt <java-option>     (optional)
    Defines an option that is to be passed directly to the Java interpreter.
    Several [-javaopt java-option] can appear in the command line.

  -install <installation>    (optional)
    Defines the installation to use. <installation> can be one of :
	standard : to use the jMax standard installation (in /usr/local/max)
	snapshot : to use the jMax ``snapshot'' installation (in 
	/usr/local/max/snapshot)
	development, user : to use the jMax installation in ${HOME}/projects/max
    Defaults to standard.

  <other-jmax-options>       (optional)
    Defines jMax options that are passed directly to ircam.jmax.MaxApplication as 
    command line options (for instance, jmaxArch, jmaxMode, ...)

  -verbose                   (optional)
    prints the command line before starting jMax

  -help
    to print this help

Notes:
  - jMax is started in background (i.e. the script terminates immediately)
  - the Java interpreter (started by the command ``java'') must be in the PATH

HELP_EOF
}

opt="none"
JAVAOPT=""
JMAXOPT=""
VERBOSE=
INSTALL="standard"

for arg in $@
do
    if [ $opt = "none" ]
    then
	case $arg in
	\-install | \-i | -javaopt)
	    opt=$arg ;;
	\-help | \-h | \-\? )
	    help ;
	    exit 2 ;;
	\-verbose | \-v)
	    VERBOSE=YES ;;
	*)
	    JMAXOPT="${JMAXOPT} $arg" ;;
	esac
    else
	case $opt in
	\-install | \-i)
	    INSTALL=$arg ;;
	\-javaopt)
	    JAVAOPT="${JAVAOPT} $arg" ;;
	esac
	opt="none";
    fi
done

case $INSTALL in
standard)
    ROOTDIR=/usr/local/max ;;
snapshot)
    ROOTDIR=/usr/local/max/snapshot/max ;;
development | user)
    ROOTDIR=${HOME}/projects/max ;;
*)
    help;
    exit 2;;
esac

CLASSPATH=.:/usr/java/lib/rt.jar:${ROOTDIR}/java/classes/jmax.jar:${ROOTDIR}/java/lib/jacl1.0/jacl.jar:${ROOTDIR}/java/lib/swing-1.0.1/swingall.jar

if [ $VERBOSE ]
then
    echo "Starting jMax with :"
    echo "   ROOTDIR set to ${ROOTDIR}"
    echo "   JAVAOPT set to ${JAVAOPT}"
    echo "   JMAXOPT set to ${JMAXOPT}"
    echo "Command line:"
    echo "java -noclassgc -noasyncgc -mx64m -ms2m $JAVAOPT -classpath $CLASSPATH ircam.jmax.MaxApplication -root $ROOTDIR $JMAXOPT &"
fi

java -noclassgc -noasyncgc -mx64m -ms2m $JAVAOPT -classpath $CLASSPATH ircam.jmax.MaxApplication -root $ROOTDIR $JMAXOPT &

