#!/bin/sh
#
#  jMax
#  
#  Copyright (C) 1999 by IRCAM
#  All rights reserved.
#  
#  This program may be used and distributed under the terms of the 
#  accompanying LICENSE.
# 
#  This program is distributed WITHOUT ANY WARRANTY. See the LICENSE
#  for DISCLAIMER OF WARRANTY.
#  


usage ()
{
  cat << USAGE_EOF

Usage:

  jmax-make-abstraction-index [-all] dir

USAGE_EOF
}

## Parameters

input_args=$@ ;
opt="none" ;
doall="no" ;

for arg in $input_args
do
  if [ $opt = "none" ]
  then 
   case $arg in
     \-x | \-f)
       opt=$arg;;
     \-help )
       usage ;
       exit 2;;
     \-h | \-\? )
       usage ;
       exit 2;;
     \-all )
	doall="yes";;
     \-* )
       echo Unknown option $arg ;
       usage ;
       exit 2;;
     * )
       target=$arg ;;
   esac
  else
   case $opt in
     \-x)
       echo Not Implemented;;
     \-f)
       echo Not Implemented;;
   esac
   opt="none";
  fi
done



## Change dir to the target

cd $target

## Remove the index if present

/bin/rm -f abstractions.tcl


if [ $doall = "yes" ]
 then
  for file in  *
  do
    if [ ! \( -d $file \) ]
    then
      name=`basename $file .abs`
      echo abstraction `basename $name .pat` '$dir'/$file >> abstractions.tcl
    fi

    echo Done file $file
  done
else
  if [ -e *.abs ]
   then
    for  file in *.abs
     do
      echo abstraction `basename $file .abs` '$dir'/$file  >> abstractions.tcl
    done
  fi

  if [ -e *.pat ]
   then
    for file in *.pat
     do
      echo abstraction `basename $file .pat` '$dir'/$file  >> abstractions.tcl
    done
  fi
fi

cat << REMEMBER_EOF
Remember to add a "abstractionDirectory $target" command in your 
.jmax file, or in the package you are defining.
REMEMBER_EOF
