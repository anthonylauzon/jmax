#!/bin/sh
help ()
{
    cat >&2 << HELP_EOF

Usage:
    jmax-tar-distrib -arch <arch> -type <type> [-tar <tar-command>]  <tar-file>

Creates the tar file of jMax distribution for architecture <arch> and type <type>.

Options:
  -arch <arch>                 (mandatory)
    defines the architecture of the release (origin, linuxpc, ...)
  -type <type>                 (mandatory)
    defines the type of the release (free, forum, ...)
  -tar <tar-command>           (optional)
    defines tar command to use (gnutar, /usr/local/bin/tar, ...)
    WARNING: this script relies on the -T - option of the used tar command.
    Default: tar.

HELP_EOF
}

OPT="none"
ARCH="none"
TYPE="none"
TAR="tar"
TARFILE="none"

for ARG in $@
do
    if [ $OPT = "none" ]
    then
	case $ARG in
	\-arch | \-tar | \-type )
	    OPT=$ARG ;;
	\-help | \-h | \-\? )
	    help ;
	    exit 2 ;;
	*)
	    TARFILE=$ARG ;;
	esac
    else
	case $OPT in
	\-arch )
	    ARCH=$ARG ;;
	\-type )
	    TYPE=$ARG ;;
	\-tar )
	    TAR=$ARG ;;
	esac
	OPT="none";
    fi
done

# Check that we have what we need
if [ $ARCH = "none" ]
then
    help
    exit 2
fi

if [ $TYPE = "none" ]
then
    help
    exit 2
fi

if [ $TARFILE = "none" ]
then
    help
    exit 2
fi

if $TAR --version | grep -s GNU >/dev/null 
then
    echo > /dev/null
else
    echo $TAR is not GNU tar. Cannot use it!
    exit 2
fi

# Create the tar file
echo "Creating tar file $TARFILE"
jmax-make-distrib-list -arch $ARCH -type $TYPE . | sed 's/^./\.\/max/' | (cd .. ; tar cvf - -T - ) | gzip -9 > $TARFILE


