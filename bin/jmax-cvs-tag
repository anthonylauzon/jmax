#!/bin/sh
# 
# jMax
# Copyright (C) 1999 by IRCAM
# 
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.
# 
# See file LICENSE for further informations on licensing terms.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
# 
# Authors: Maurizio De Cecco, Francois Dechelle, Enzo Maggi, Norbert Schnell.
#



# ---------------------------------------------------------------------------
help ()
{
    cat >&2 << HELP_EOF

Usage:
    jmax-cvs-tag [-qualifier <qualifier>] [<other cvs options>]

Does a ``cvs tag'' of the sources of jMax.

The tag used is the following string:
V_M_N_P_<qualifier>
where M, N and P are respectively the major number, minor number and
patch level of the current release, taken from file VERSION.

Options:
  -qualifier <qualifier>           (mandatory)
    defines the qualifier part of the tag (for instance, TRY1 or FINAL)
  <other-cvs-options>              (optional)
    Options that are passed directly to cvs (as -F for example)
  

HELP_EOF
}

# ---------------------------------------------------------------------------
# Options decrypting
OPT="none"
QUALIFIER=
CVSOPT=

for ARG in $@
do
    if [ $OPT = "none" ]
    then
	case $ARG in
	\-qualifier )
	    OPT="-qualifier" ;;
	\-help | \-h | \-\? )
	    help ;
	    exit 2 ;;
	*)
	    CVSOPT="$CVSOPT $ARG" ;;
	esac
    else
	case $OPT in
	\-qualifier )
	    QUALIFIER=$ARG ;;
	esac
	OPT="none";
    fi
done

# ---------------------------------------------------------------------------
# Check that we have all what we need
if [ `hostname` != maelzel ]
then
    echo "Incorrect host (log on maelzel to call this script, because CVS ...)"
    exit 1
fi

if [ \! -r VERSION ]
then
    echo "Cannot find file VERSION (probably you're not in the correct directory ...)"
    exit 1
fi

# ---------------------------------------------------------------------------
MAJOR=`awk '$1=="MAJOR" { print $2; }' VERSION`
MINOR=`awk '$1=="MINOR" { print $2; }' VERSION`
PATCH_LEVEL=`awk '$1=="PATCH_LEVEL" { print $2; }' VERSION`

VERSION=$MAJOR.$MINOR.$PATCH_LEVEL

V=`echo $VERSION | sed -e 's/^/V_/' -e 's/\./_/g'`
if [ $QUALIFIER ]
then
    TAG="${V}_${QUALIFIER}"
else
    TAG="${V}"
fi

echo "cvs tag $CVSOPT $TAG"
cvs tag $CVSOPT $TAG
