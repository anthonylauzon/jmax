dnl Process this file with autoconf to produce a configure script

AC_INIT(fts/version.c.in)

. $srcdir/JMAX-VERSION
JMAX_VERSION=${JMAX_MAJOR_VERSION}.${JMAX_MINOR_VERSION}.${JMAX_PATCH_VERSION}${JMAX_VERSION_STATUS}

VERSION=${JMAX_VERSION}
PACKAGE=jmax

AM_INIT_AUTOMAKE(jmax,${JMAX_VERSION})

AC_PREFIX_DEFAULT(/usr)

AM_CONFIG_HEADER(include/ftsconfig-ac.h)

dnl Checks for programs.
AC_PROG_CC
if test "$ac_cv_prog_cc" = "no" ; then
   AC_MSG_ERROR([*** No C compiler])
fi
AC_ISC_POSIX
AC_PROG_INSTALL
AC_LIBTOOL_DLOPEN
AM_PROG_LIBTOOL

CFLAGS="-Wall -Wno-unused"

dnl Check for debug
AC_ARG_ENABLE(debug,
  [  --enable-debug[=value]   compile with debug [default=no]],
  debug="yes",
  debug="no")
case "$debug" in
 yes)
  CFLAGS="$CFLAGS -g"
  AC_DEFINE(DEBUG,1,[Define to enable debug])
  ;;
esac

dnl Check for memory allocation debug
AC_ARG_ENABLE(check_memory,
  [  --enable-check-memory[=value]   compile with -fcheck-memory-usage [default=no]],
  check_memory="yes",
  check_memory="no")
case "$check_memory" in
 yes)
  CFLAGS="$CFLAGS -fcheck-memory-usage"
  ;;
esac

dnl Checks for libraries.
AC_CHECK_LIB(m, sin)
AC_CHECK_FUNCS(sinf cosf tanf asinf acosf atanf expf logf log10f)

dnl Checks for header files.
AC_HEADER_STDC
AC_HAVE_HEADERS( sys/param.h unistd.h alloca.h sys/time.h time.h sys/socket.h netinet/in.h arpa/inet.h netdb.h)

dnl Checks for typedefs, structures, and compiler characteristics.
AC_C_CONST
ACX_C_RESTRICT
AC_C_BIGENDIAN

dnl Checks for library functions.
AC_FUNC_ALLOCA
AC_CHECK_FUNCS(socket)

dnl Check for Electric Fence (a library to track memory corruption errors on Linux)
AC_ARG_ENABLE(electric-fence,
    [  --enable-electric-fence[=value]   link with ElectricFence, a library to track memory corruption errors on Linux  [default=no]],
    electric_fence="yes",
    electric_fence="no")

dnl Check for platform-specific code
AC_CANONICAL_HOST
case "$host" in
dnl FIXME: must add conditionnal tests for ALSA
i*86-pc-linux-gnu)
    PLATFORM=linux ;
    PLATFORM_PACKAGES="alsa oss unixdtd" ;
    FTS_SYS_LIBS="-ldl -laudiofile -lpthread" ;
    if test "$electric_fence" = "yes" ; then FTS_SYS_LIBS="-lefence $FTS_SYS_LIBS" ; fi ;
    ;;

mips-sgi-irix6.5)
    PLATFORM=sgi ;
    PLATFORM_PACKAGES="sgi unixdtd" ;
    FTS_SYS_LIBS="-ldl -laudiofile";
    ;;
powerpc-apple-darwin*)
    PLATFORM=macosx ;
    PLATFORM_PACKAGES="macosx"  ;;
esac

AC_SUBST(PLATFORM)
AC_SUBST(PLATFORM_PACKAGES)
AC_SUBST(FTS_SYS_LIBS)

dnl Check installation directories
if test "x${prefix}" = "xNONE"; then
  AC_DEFINE_UNQUOTED(DEFAULT_ROOT, "${ac_default_prefix}/share/jmax")
else
  AC_DEFINE_UNQUOTED(DEFAULT_ROOT, "${prefix}/share/jmax")
fi

FTSDIR=${bindir}
ROOTDIR="${datadir}/jmax"

AC_SUBST(FTSDIR)
AC_SUBST(ROOTDIR)

dnl Check for Java compiler
dnl AC_PROG_JAVAC
JAVACX=javac
AC_SUBST(JAVACX)
JAVACFLAGSX=
case "$debug" in
 yes)
  JAVACFLAGSX="-g"
  ;;
esac
AC_SUBST(JAVACFLAGSX)

dnl Generate include/fts/config.h
dnl provides: pointer-to-int conversions

echo creating config.h
outfile=include/fts/config.h-tmp
configfile=include/fts/config.h
cat > $outfile <<\_______EOF
/* config.h
 *
 * This is a generated file.  Please modify `configure.in'
 */

_______EOF

cat >> $outfile <<\_______EOF
/* Macros for pointer to int conversion.
   These macros are yet hardcoded, but should be generated by configure.in.
   See glib sources for more info.
*/
#define POINTER_TO_UINT(p) ( (unsigned int) (p) )
#define UINT_TO_POINTER(u) ( (void *) (u) )

_______EOF

if cmp -s $outfile include/fts/config.h
then
 echo include/fts/config.h is unchanged
 rm -f $outfile
else
 mv $outfile include/fts/config.h
fi


dnl Run configure in subdirectories
AC_CONFIG_SUBDIRS(client)

AC_OUTPUT(
Makefile
fts/Makefile
fts/version.c
include/Makefile
include/fts/Makefile
include/ftsprivate/Makefile
bin/Makefile
bin/jmax
tcl/Makefile
config/Makefile
images/Makefile
tutorials/Makefile
tutorials/basics/Makefile
java/src/ircam/jmax/JMaxVersion.java
java/Makefile
java/lib/Makefile
java/lib/jacl/Makefile
java/src/Makefile
java/src/ircam/Makefile
java/src/ircam/jmax/Makefile
java/src/ircam/jmax/dialogs/Makefile
java/src/ircam/jmax/editors/Makefile
java/src/ircam/jmax/editors/console/Makefile
java/src/ircam/jmax/editors/patcher/Makefile
java/src/ircam/jmax/editors/patcher/actions/Makefile
java/src/ircam/jmax/editors/patcher/interactions/Makefile
java/src/ircam/jmax/editors/patcher/menus/Makefile
java/src/ircam/jmax/editors/patcher/objects/Makefile
java/src/ircam/jmax/fts/Makefile
java/src/ircam/jmax/mda/Makefile
java/src/ircam/jmax/script/Makefile
java/src/ircam/jmax/script/pkg/Makefile
java/src/ircam/jmax/script/scm/Makefile
java/src/ircam/jmax/script/scm/silk/Makefile
java/src/ircam/jmax/script/tcl/Makefile
java/src/ircam/jmax/toolkit/Makefile
java/src/ircam/jmax/toolkit/actions/Makefile
java/src/ircam/jmax/toolkit/menus/Makefile
java/src/ircam/jmax/widgets/Makefile
java/src/silk/Makefile
packages/Makefile
packages/alsa/Makefile
packages/alsa/c/Makefile
packages/alsa/c/src/Makefile
packages/control/Makefile
packages/control/c/Makefile
packages/control/c/src/Makefile
packages/control/help/Makefile
packages/data/Makefile
packages/data/c/Makefile
packages/data/c/src/Makefile
packages/data/java/Makefile
packages/data/java/src/Makefile
packages/data/java/src/Makefile
packages/data/java/src/ircam/Makefile
packages/data/java/src/ircam/jmax/Makefile
packages/data/java/src/ircam/jmax/editors/Makefile
packages/data/java/src/ircam/jmax/editors/bpf/Makefile
packages/data/java/src/ircam/jmax/editors/bpf/renderers/Makefile
packages/data/java/src/ircam/jmax/editors/bpf/tools/Makefile
packages/data/java/src/ircam/jmax/editors/table/Makefile
packages/data/java/src/ircam/jmax/editors/table/actions/Makefile
packages/data/java/src/ircam/jmax/editors/table/menus/Makefile
packages/data/java/src/ircam/jmax/editors/table/renderers/Makefile
packages/data/java/src/ircam/jmax/editors/table/tools/Makefile
packages/data/help/Makefile
packages/data/images/Makefile
packages/explode/Makefile
packages/explode/c/Makefile
packages/explode/c/src/Makefile
packages/explode/java/Makefile
packages/explode/java/src/Makefile
packages/explode/java/src/Makefile
packages/explode/java/src/ircam/Makefile
packages/explode/java/src/ircam/jmax/Makefile
packages/explode/java/src/ircam/jmax/editors/Makefile
packages/explode/java/src/ircam/jmax/editors/explode/Makefile
packages/explode/java/src/ircam/jmax/editors/explode/actions/Makefile
packages/explode/java/src/ircam/jmax/editors/explode/menus/Makefile
packages/explode/help/Makefile
packages/explode/images/Makefile
packages/guiobj/Makefile
packages/guiobj/c/Makefile
packages/guiobj/c/src/Makefile
packages/guiobj/java/Makefile
packages/guiobj/java/src/Makefile
packages/guiobj/java/src/Makefile
packages/guiobj/java/src/ircam/Makefile
packages/guiobj/java/src/ircam/jmax/Makefile
packages/guiobj/java/src/ircam/jmax/guiobj/Makefile
packages/guiobj/help/Makefile
packages/guiobj/images/Makefile
packages/io/Makefile
packages/io/c/Makefile
packages/io/c/src/Makefile
packages/io/help/Makefile
packages/ispw/Makefile
packages/ispw/c/Makefile
packages/ispw/c/src/Makefile
packages/ispw/java/Makefile
packages/ispw/java/src/Makefile
packages/ispw/java/src/Makefile
packages/ispw/java/src/ircam/Makefile
packages/ispw/java/src/ircam/jmax/Makefile
packages/ispw/java/src/ircam/jmax/ispw/Makefile
packages/ispw/help/Makefile
packages/ispw/help/control/Makefile
packages/ispw/help/signal/Makefile
packages/ispw/images/Makefile
packages/ispwmath/Makefile
packages/ispwmath/c/Makefile
packages/ispwmath/c/src/Makefile
packages/ispwmath/help/Makefile
packages/lists/Makefile
packages/lists/c/Makefile
packages/lists/c/src/Makefile
packages/lists/help/Makefile
packages/math/Makefile
packages/math/c/Makefile
packages/math/c/src/Makefile
packages/math/help/Makefile
packages/midi/Makefile
packages/midi/c/Makefile
packages/midi/c/src/Makefile
packages/midi/help/Makefile
packages/numeric/Makefile
packages/numeric/c/Makefile
packages/numeric/c/src/Makefile
packages/numeric/help/Makefile
packages/oss/Makefile
packages/oss/c/Makefile
packages/oss/c/src/Makefile
packages/oss/help/Makefile
packages/qlist/Makefile
packages/qlist/c/Makefile
packages/qlist/c/src/Makefile
packages/qlist/java/Makefile
packages/qlist/java/src/Makefile
packages/qlist/java/src/Makefile
packages/qlist/java/src/ircam/Makefile
packages/qlist/java/src/ircam/jmax/Makefile
packages/qlist/java/src/ircam/jmax/editors/Makefile
packages/qlist/java/src/ircam/jmax/editors/qlist/Makefile
packages/qlist/java/src/ircam/jmax/editors/qlist/actions/Makefile
packages/qlist/java/src/ircam/jmax/editors/qlist/menus/Makefile
packages/sequence/Makefile
packages/sequence/c/Makefile
packages/sequence/c/src/Makefile
packages/sequence/java/Makefile
packages/sequence/java/src/Makefile
packages/sequence/java/src/Makefile
packages/sequence/java/src/ircam/Makefile
packages/sequence/java/src/ircam/jmax/Makefile
packages/sequence/java/src/ircam/jmax/editors/Makefile
packages/sequence/java/src/ircam/jmax/editors/sequence/Makefile
packages/sequence/java/src/ircam/jmax/editors/sequence/actions/Makefile
packages/sequence/java/src/ircam/jmax/editors/sequence/menus/Makefile
packages/sequence/java/src/ircam/jmax/editors/sequence/renderers/Makefile
packages/sequence/java/src/ircam/jmax/editors/sequence/tools/Makefile
packages/sequence/java/src/ircam/jmax/editors/sequence/track/Makefile
packages/sequence/help/Makefile
packages/sequence/images/Makefile
packages/signal/Makefile
packages/signal/c/Makefile
packages/signal/c/src/Makefile
packages/signal/help/Makefile
packages/system/Makefile
packages/system/c/Makefile
packages/system/c/src/Makefile
packages/system/help/Makefile
packages/unixdtd/Makefile
packages/utils/Makefile
packages/utils/c/Makefile
packages/utils/c/src/Makefile
utils/Makefile
utils/rpm/Makefile
utils/rpm/jmax.spec
)
