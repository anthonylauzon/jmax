<html>
<!--                                                                      -->
<!-- jMax                                                                 -->
<!--                                                                      -->
<!-- Copyright (C) 1999 by IRCAM                                          -->
<!-- All rights reserved.                                                 -->
<!--                                                                      -->
<!-- This program may be used and distributed under the terms of the      -->
<!-- accompanying LICENSE.                                                -->
<!--                                                                      -->
<!-- This program is distributed WITHOUT ANY WARRANTY. See the LICENSE    -->
<!-- for DISCLAIMER OF WARRANTY.                                          -->
<!--                                                                      -->
<head>
<title>jMax Documentation</title>
</head>

<body bgcolor="white">

<table width=100% border=0 cellspacing=0 cellpadding=0>
<tr>
  <td align=left valign=top>
    <a href="http://www.ircam.fr/jmax/"><img src="images/jmax_logo_small_transp.gif" border=0 alt="jMax"></A>
  </td>
  <td align=right valign=top>
    <a href="http://www.ircam.fr/"><img src="images/ircam_banner.gif" border=0 alt="IRCAM - Centre Georges Pompidou"></a>
  </td>
</tr>

</table>


<table width=75% border=0 cellspacing=0 cellpadding=0>

<tr>
<td><spacer type="block" height="1" width="1"></td>
</tr>

<tr>
<td align=right><font size=+3><b>Projects and packages</b></font></td>
</tr>

<tr>
<td align=right valign=top><a href="index.html"><font size=-1><i>j</i>Max Documentation</font></a></td>
</tr>

<tr>
<td><spacer type="block" height="1" width="1"></td>
</tr>

</table>

<!-- ---------------------------------------------------------------------- -->
<!-- ---------------------------------------------------------------------- -->
<!-- End of header                                                          -->
<!-- ---------------------------------------------------------------------- -->
<!-- ---------------------------------------------------------------------- -->

<p>
<UL TYPE=DOT>
  <LI><A HREF="#disclaimer"> Disclaimer </A>
  <LI><A HREF="#introduction"> What is a Package?</A>
  <LI><A HREF="#commands"> Commands</A>
  <LI><A HREF="#project"> What is a Project?</A>
  <LI><A HREF="#env"> The Project File </A>
  <LI><A HREF="#commands"> Commands</A>
  <LI><A HREF="#example"> Project File Example</A>
</UL>

<p>
<hr size=1>

<A NAME="disclaimer"> 
<H2> Disclaimer </H2> 

<P>
The current version of <I>j</I>Max use TCL as its
scripting language, and the feature described in this document is
currently based on TCL; future version of <I>j</I>Max may
use a different scripting language, so the features described here
will change, will be implemented with a different language and/or
syntax, or will simply vanish.

<P>
<A NAME="introduction">
<HR>
<H2> What is a Package?</H2>

<P>
A package is a way to package and distribute <I>j</I>Max
component, i.e. any kind of library made up of patches, templates, Max
0.26 abstractions, soundfiles, object libraries, Java libraries,
documentation, help files and so on; <I>j</I>Max are based on TCL
packages, and are currently based on <A HREF="http://www.scriptics.com/java/"> jacl </A>,
a Java implementation of the TCL scripting language.

<P>
<A NAME="commands">
<HR>
<H2> Commands</H2>

<p>
This release do not (<i>yet</i>) document how to build up a package; for some examples,
take a look to under the <i>packages</i> subdirectory in your <I>j</I>Max installations.
The following command is used to load a package (note that is actually a standard TCL
command).
<P>
<DL>
  <DT> <tt>package require</tt> <i>name</i> <p>
  <DD> 
    The package named <i>name</i> is loaded if not already loaded.
    The package in general consists of a directory named <i>name</i>; this directory
    is searched in all the directory contained in the TCL variables jmaxPkgPath,
    that should be a TCL list; if the package is not found, is searched in the
    packages part of the distribution.
</DL>

<P>
<A NAME="project">
<HR>
<H2> What is a Project?</H2>

<P>
<I>j</I>Max is, after all, a programming language; and while it's
learning curve and its graphical roots make it a good choice for
starting developping small MIDI or sounds oriented applications, it is
often used to develop medium or large sized projects, projects in the
order of hundred of thousands of objects, equivalent to program of
hundred of thousands lines of code.

<P>
Projects of this size require, together with easy of use of the basic
tools, some tool that help to manage the complexity of developements
and delivery of applications and libraries.  In this release
<I>j</I>Max introduce two set of features, a simple and rougth support for projects to handle
applications, and the support of the concept of <A HREF="packages.html"> package
</A>, to handle delivery of libraries.

<P>
A <I>j</I>Max project is usually made by of many kind of components: patches, templates,
soundfiles,  object libraries, Java libraries, documentation, help files and so on; managing a project
means being able to load/install all these components, to browse and edit the project structure,
to handle the dependencies between this components and other components external to the project
and so on.

<P>
Currently <I>j</I>Max provide a simple mechanism to load/install all the components,
by means of a script file, 
and, thru the <A HREF="packages.html"> packages </A>, a way to handle depedencies; future
release will introduce more functionalities.

<P>
<A NAME="env">
<HR>
<H2> The Project File </H2>

<P>
A <I>j</I>Max project is contained in a directory and all its subdirectory; 
this directory is called <I> the project directory</I>.
The main patch, i.e. the patch that is loaded in order to load the project,
should be in the project directory.

<P>
The project directory can contain an other file, called the project 
file, that is a script that load/install all the components needed by the project.

<P>
The project  file is loaded before the patch, and is found thru a naming
convention; if the file is called "foo.jmax" or "foo.pat", <I>j</I>Max look first
for a file called "foo.env", and if this file does not exists, it look for a file
called "project.env"; this naming convention allows to have multiple project file
in the same directory (usefull for small projects) or to share a single project file
between different patches (for example, different version of the same patch).

<P>
The project file is currently a TCL file; the TCL commands
are evaluated in an environment where the <code>dir</code> variable is defined to have
the value of the project directory, so it can be used to build filename relative to the
project directory, so that no dependency on the absolute path need to be coded in the

<P>
The project file can contains a number of TCL commands that load or
install the different kind of components in <I>j</I>Max; for this release, the commands
needed to install user developed libraries (<code>C</code> or <code>Java</code>) are
not documented; the project file can also, in special case, contains <A HREF="config/io.html">
I/O configuration commands</A>, when you want to be sure that a project run 
in a specific configuration.

<P>
The currently <I>j</I>Max is not able to properly undo all the action in
a project file; we suggest, for the moment, to restart before changing project.

<p>
Note that in some sense you can consider your <A
HREF="getting_started.html#.jmaxrc"><code>.jmaxrc</code> </A> file
as a default project file; all the commands available in the project
file can be put in the <code>when start</code> hook, and thus apply to
all the patches loaded in all the session; this is usefull while
developping small applications that do not require a project
organization.

<P>
<A NAME="commands">
<HR>
<H2> Commands</H2>

<p>
The following are the available commands; the command name is printed in
<code>this</code> typeface, while the arguments are type in <i>this</i> typeface;
since the project file is a TCL file, any TCL command
can be included in the file; but, as we <A HREF="#disclamier"> said </A>, we don't guarantee
that future version will still use TCL as scripting language; anyway, future
scripting language will the following commands, possibly with a different syntax.

<DL>
  <DT><tt><b>#</b></tt> <i>anything</i><p>
  <DD>
    Anything after the <code>#</code> is considered a comment and ignored.<p>

  <DT><tt><b>package require</b></tt> <i>package</i><p>
  <DD> 
    Load a package named <i>package</i>; packages are libraries of different kind of 
    functionalities, including patch libraries and UI components; see 
    <A HREF="packages.html"> the packages documentation</A> for details.  <p>

  <DT><tt><b>templateDirectory</b></tt> <i>directory</i><p>
  <DD> 
    Add the directory <i>directory</i> to the list of directories where
    templates are searched; in a project file, usually <i>directory</i>
    is a subdirectory of the project directory where templates are stored.<p>

  <DT><tt><b>template</b></tt> <i>name</i> <i>filename</i><p>
  <DD> 
    Declare a single template called <i>name</i>, and set its definition
    to be the patch stored in the file <i>filename</i>; the file must be a 
    in the <I>j</I>Max format.<p>

  <DT><tt><b>abstractionDirectory</b></tt> <i>directory</i><p>
  <DD> 
    Add the directory <i>directory</i> to the list of directories where
    Max 0.26 abstractions  are searched; in a project file, usually <i>directory</i>
    is a subdirectory of the project directory where abstractions are stored.<p>

  <DT><tt><b>abstraction</b></tt> <i>name</i> <i>filename</i><p>
  <DD> 
    Declare a single Max 0.26 abstraction called <i>name</i>, and set its definition
    to be the patch stored in the file <i>filename</i>;  the file must be a 
    in the Max 0.26 format.<p>

  <DT><tt><b>dataDirectory</b></tt> <i>directory</i><p>
  <DD> 
    Add the directory <i>directory</i> to the list of directories where
    soundfiles and miscellaneous data files are searched. The project directory
    is always implicitly part of this list.<p>

  <DT><tt><b>declareIcon</b></tt> <i>name</i> <i>filename</i><p>
  <DD> 
    Create a new icon, named <i>name</i>, taking its content from <i>filename</i>.
    <i>filename</i> must be a image file, of a format reconized by the Java VM; (currently, GIF
    and JPEG files).
    If the <i>name</i> start with a <code>%</code> character, then the icon can be used
    on comments; otherwise, the <i>name</i> is interpreted as the name of a class or
    template, and the icon will be used to represent instances of this class or template
    in the patcher editor.<p>
    If the <i>name</i> start with an underscore (<code>_</code>), the icon will not be
    used either for comments or for templates, but it is available to Java written modules
    thru a specific API.

  <DT><tt><b>patcherMenu</b></tt> <i>cmd</i> [<i>submenu</i>] <i>label</i> <i>object</i> <i>message</i><p>
  <DD>
    Add an item to the patcher editor popup menu; <i>cmd</i> specify which kind of action
    the menu item will perform: currently, only <code>add</code> is supported, and correspond
    to adding a new object.<br>
    The optional <i>submenu</i> command tell to add the new menu item in a submenu, having
    as label the <i>submenu</i> argument; if the <i>submenu</i> argument start with a <code>%</code>,
    it is considered as the name of an icon to use for the submenu item; if the submenu do not
    exists it is automatically created.<br>
    The <i>label</i> argument is used as a label for the new menu item;  if it argument start
    with a <code>%</code>,  it is considered as the name of an icon to use for the item.<br>
    The <i>object</i> is a text describing the object to be added, including its argument;
    note that if you want to specify an iconic comment, the description should be "comment %iconName".
    The <i>message</i> argument will be shown, as it is, in the status line while adding the object. <br>
    This command is usefull to specify menu short-cuts usefull for a given project, like frequently
    used templates or objects.<p>
    

  <DT><tt><b>puts</b></tt> <i>arg</i><p>
  <DD> 
    A TCL commands, print its argument (that can be a double quoted
    string) to the <I>j</I>Max  console when the project file is loaded.<p>

</DL>

<P>
<A NAME="example">
<HR>
<H2> Project File Example</H2>

<pre>
# This package require the Ircam spat library
package require spat

# Old Max 0.26 abstraction are in subdirectory abstractions
abstractionDirectory $dir/abstractions

# New templates are in subdirectory templates
templateDirectory $dir/templates

# Special templates for this project

template foo  $dir/special/foo.jmax
template bar  $dir/special/bar.jmax
template frob $dir/special/frob.jmax

# Use a special version of the Max0.26 abstraction linedrive

abstraction linedrive $dir/special/linedrive.abs

# Sound files are in the snd directory

dataDirectory $dir/snd

# pbank and other files are in the data directory

dataDirectory $dir/data
</pre>


<!-- ---------------------------------------------------------------------- -->
<!-- ---------------------------------------------------------------------- -->
<!-- Beginning of footer                                                    -->
<!-- ---------------------------------------------------------------------- -->
<!-- ---------------------------------------------------------------------- -->

<p>
<table width=100% border=0 cellspacing=0 cellpadding=0>

<tr>
<td><spacer type="block" height="20" width="1"></td>
</tr>

<tr>
<td bgcolor="#cccccc"><spacer type="block" height="1" width="1"></td>
</tr>

<tr>
<td><spacer type="block" height="20" width="1"></td>
</tr>

<tr>
<td align=right><font size=-2>
Copyright &copy; 1995,1999 <a href="http://www.ircam.fr/">IRCAM</a>.<br>
All rights reserved.
</font></td>
</tr>

</table>

</body>
</html>
