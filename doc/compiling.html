<html>
<!--                                                                      -->
<!-- jMax                                                                 -->
<!--                                                                      -->
<!-- Copyright (C) 1999 by IRCAM                                          -->
<!-- All rights reserved.                                                 -->
<!--                                                                      -->
<!-- This program may be used and distributed under the terms of the      -->
<!-- accompanying LICENSE.                                                -->
<!--                                                                      -->
<!-- This program is distributed WITHOUT ANY WARRANTY. See the LICENSE    -->
<!-- for DISCLAIMER OF WARRANTY.                                          -->
<!--                                                                      -->
<head>
<title>jMax Documentation</title>
</head>

<body bgcolor="white">

<table width=100% border=0 cellspacing=0 cellpadding=0>
<tr>
  <td align=left valign=top>
    <a href="http://www.ircam.fr/jmax/"><img src="images/jmax_logo_small_transp.gif" border=0 alt="jMax"></A>
  </td>
  <td align=right valign=top>
    <a href="http://www.ircam.fr/"><img src="images/ircam_banner.gif" border=0 alt="IRCAM - Centre Georges Pompidou"></a>
  </td>
</tr>

</table>


<table width=75% border=0 cellspacing=0 cellpadding=0>

<tr>
<td><spacer type="block" height="1" width="1"></td>
</tr>

<tr>
<td align=right><font size=+3><b>Compiling <i>j</i>Max</b></font></td>
</tr>

<tr>
<td align=right valign=top><a href="index.html"><font size=-1><i>j</i>Max Documentation</font></a></td>
</tr>

<tr>
<td><spacer type="block" height="1" width="1"></td>
</tr>

</table>

<!-- ---------------------------------------------------------------------- -->
<!-- ---------------------------------------------------------------------- -->
<!-- End of header                                                          -->
<!-- ---------------------------------------------------------------------- -->
<!-- ---------------------------------------------------------------------- -->


<p>
<ul type=dot>
  <li><a href="#introduction">Introduction</A>
  <li><a href="#prerequisites">Prerequisites</A>
  <li><a href="#compilation">Compilation</A>
  <li><a href="#rpm">Building rpms</A>
</ul>

<p>
<hr size=1>

<a name="introduction"> <H2>Introduction</H2> </a>

<p>
This document explains how to recompile jMax from a source distribution.

<p>
Thanks to Michael Lechasseur (mlecha@music.mcgill.ca) for contributions
to this document.

<!-- ---------------------------------------------------------------------- -->
<p>
<hr>
<a name="prerequisites"> <h3>Prerequisites</h3> </a>

<p>
The following elements are needed to recompile jMax:
<ul>
<li> the Java Development Kit (JDK) version 1.1.6 or higher.
<li> the Swing classes library
<li> the C compiler
<li> GNU make
<li> audiofile library on Linux
</ul>


<h4>Using JDK 1.2</h4>

<p>
<strong>Note:</strong> <i>j</i>Max cannot yet be compiled with JDK 1.2, because 1) of a class name
conflict and 2) of Jacl which does not loads. This will be solved in future <i>j</i>Max releases.


<h4>Swing classes library</h4>

<p>
The Swing classes are part of the Java Foundation Classes.
Swing is included in the JDK version 1.2, but it must be downloaded
if you use a JDK version 1.1.x.

<p>
Swing can be downloaded at: 
<a href="http://java.sun.com/products/jfc/download.html">http://java.sun.com/products/jfc/download.html</a>.
Be sure to get the standard .zip or .tar and <b>not</b> a Win9x/Max/Solaris executable.


<h4>SGI platform</h4>

<p>
The JDK for SGI platforms can be downloaded at:
<a href="http://www.sgi.com/Products/Evaluation/#jdk">
http://www.sgi.com/Products/Evaluation/#jdk</a>

<p>
The JDK for SGI is distributed as a package that installs itself in <code>/usr/java</code>.
You must add the following to your <code>.cshrc</code> file (modify accordingly if
you are using another shell):
<pre>
  setenv PATH "${PATH}:/usr/java/bin"
  setenv JDK_HOME /usr/java/
  setenv JAVA_HOME /usr/java/
</pre>

<p>
On SGI platform, GNU make resides in <code>/usr/freeware/bin/gmake</code>.


<h4>Linux platform</h4>

<p>
The JDK for Linux platforms can be downloaded at:
<a href="http://www.blackdown.org/java-linux.html">
http://www.blackdown.org/java-linux.html</a>

<p>
You can install the JDK in the directory of your choice,
as long as the JDK directory is defined in environment variables.
The following place can be used for example: <code>/usr/local/java</code>.

<p>
Once you have defined installation directory, you must add environment 
variables definition. This can be done by adding the following lines
(modify <code>JAVA_HOME</code> to reflect
the current settings of your system):
<pre>
JAVA_HOME="/usr/local/java"
PATH="$JAVA_HOME/bin:$PATH"
</pre>
to your <code>.bashrc</code> file in your home directory (modify
accordingly if you are using another shell).

<p>
Once this is done, you can check that the environment is correct by
running the Java VM:
<pre>
echo $PATH
echo $CLASSPATH
java -version
</pre>

<p>
If the "Kaffe Java Virtual Machine" is installed on your system, you'll need
to make sure that jMax finds the JDK binaries before it finds the Kaffe
binaries.  If you have Kaffe installed you'll get the output "Kaffe Virtual
Machine" by typing "java -version" at the command line.   You need to make
the path to your JDK directory apprear first in your PATH statement, or you
need to rename the Kaffe files to prevent their use:
<pre>
  mv /usr/bin/java /usr/bin/java-kaffe
  mv /usr/bin/javac /usr/bin/javac-kaffe
  mv /usr/bin/jar /usr/bin/jar-kaffe
</pre>

<p>
<strong>Note:</strong> it has been reported that Kaffee does not currently run jMax. We recommend
that you use JDK instead.

<p>
<i>j</i>Max can be compiled using standard gcc, egcs or Pentium gcc. 
However, Pentium gcc is recommended for performance.
Check <a href="http://www.goof.com/pcg/binaries-linux.html">http://www.goof.com/pcg/binaries-linux.html</a>
for downloading Pentium gcc (file for latest version is pgcc-1.1.3-linux-x86-glibc.tar.gz).

<p>
<strong>Note:</strong> some erratic arithmetic problems have also been reported when 
compiling with gcc 2.7.x and some versions of egcs or Pentium gcc. If you experience
erratic behavior (object <code>osc1~</code> changes its output frequency
from one octave without external intervention, midi objects (<code>pgmin</code>,
<code>mtof</code>, ...) always output zero, ...), then try with another compiler
version, or change compiler options (-mpentiumpro instead of -mpentium, ...).

<p>
You can check the compiler version you are using by command: <br>
<code>gcc -v</code>. This will output for example (for Pentium gcc version 1.1.1):
<pre>
Reading specs from /usr/local/pgcc/lib/gcc-lib/i586-pc-linux-gnu/pgcc-2.91.60/specs
gcc version pgcc-2.91.60 19981201 (egcs-1.1.1 release)
</pre>

<p>
jMax uses the <i>Audio File Library</i>,
by Michael Pruett, available under the GNU Library General Public
License. This library must be installed before recompiling jMax
and can be obtained from the following sources:
<ul>
<li> various rpms available in standard distributions or on rpm sites 
(<a href="http://rufus.w3.org/linux/RPM/ByName.html">http://rufus.w3.org/linux/RPM/ByName.html</a>
for example)
<li> sources from cvs server at <a href="http://www.gnome.org">http://www.gnome.org</a>
<li><a href="http://www.68k.org/~michael/audiofile/">http://www.68k.org/~michael/audiofile/</a>
</ul>

<p>
<strong>Note:</strong> the <i>Audio File Library</i> version must be 0.1.7 or higher


<h4>Swing installation</h4>

<p>
You can install the Swing classes in the directory of your choice,
as long as the Swing directory is defined in environment variables.
The following place can be used for example: <code>/usr/share/jfc</code>.

<p>
Once you have defined installation directory, you must add environment 
variables definition. This can be done by adding the following lines
(modify <code>SWING_HOME</code> to reflect the current settings of your system):
<pre>
SWING_HOME="/usr/share/jfc/swing1.1.1"
CLASSPATH="$SWING_HOME/lib/swingall.jar"
export CLASSPATH
</pre>
to your <code>.bashrc</code> or <code>.cshrc</code> file in your home directory (modify
accordingly if you are using another shell).

<p>
Once this is done, you can compile a small Java program that uses Swing:
<pre>
import java.awt.*;
import java.awt.event.*;
import javax.swing.*;

class Test extends JFrame {

  Test()
  {
    addWindowListener( new WindowAdapter() {
      public void windowClosing(WindowEvent e) 
	{
	  System.exit(0);
	}
    });

    setSize( 200, 200);

    getContentPane().add( new JButton( "I'm a Swing button"));

    setVisible( true);
  }

  public static void main( String args[])
  {
    new Test();
  }
}
</pre>

<p>
Save this in a file named <code>Test.java</code>, compile it with <code>javac 
Test.java</code> and run it with <code>java Test</code>. It should 
open a window containing a button.


<!-- ---------------------------------------------------------------------- -->
<p>
<hr>
<a name="compilation"> <h3>Compilation</h3></A>

<p>
The compilation must be started in <i>j</i>Max sources root directory.
Compilation command must specify both a target and an architecture which
is passed in make variable <code>ARCH</code>.


<h4>General compilation targets</h4>

<p> 
The following targets are defined in the top-level Makefile:
<ul>
<li> <code>all</code>: to recompile both C and Java part. The make variable <code>ARCH</code>
must be defined
<li> <code>clean</code>: to remove all C objects, executables, libraries and all Java .class and .jar files. 
The make variable <code>ARCH</code> must be defined
<li> <code>all_c</code>: to recompile only C part. The make variable <code>ARCH</code>
must be defined
<li> <code>clean_c</code>: to remove all C objects, libraries and executables. The make variable <code>ARCH</code> must be defined
<li> <code>clean_java</code>: to remove all Java .class and .jar files. The make variable <code>ARCH</code> must be defined
</ul>


<h4>Compilation architecture</h4>

<p>
The following architecture names are defined:
<ul>
<li> <code>i386-linux</code>: Linux on Intel Pentium compatible processors
<li> <code>i686-linux</code>: Linux on Intel Pentium-II compatible processors
<li> <code>r10k-irix6.5</code>: Irix 6.5 on MIPS R10000 processors
<li> <code>r4k-irix6.5</code>: Irix 6.5 on MIPS R4000 processors
<li> <code>r5k-irix6.5</code>: Irix 6.5 on MIPS R5000 processors
<li> <code>ppc-linux</code>: Linux on PowerPC processors
<li> <code>ppc-macosx</code>: MacOS-X on PowerPC processors
</ul>

<p>
These architecture names are passed to the makefiles by the <code>ARCH</code> variables, as in:
<pre>
make clean ARCH=i686-linux
</pre>


<h4>Platform specific targets</h4>

<p>
The following platform specific targets are defined:
<ul>
<li> <code>i386-linux</code>: compilation of C and Java parts for architecture i386-linux
<li> <code>i686-linux</code>: compilation of C and Java parts for architecture i686-linux
<li> <code>ppc-linux</code>: compilation of C and Java parts for architecture ppc-linux
<li> <code>ppc-macosx</code>: compilation of C and Java parts for architecture ppc-macosx
<li> <code>sgi</code>: compilation of C and Java parts for architectures r10k-irix6.5 and r5k-irix6.5
</ul>


<h4>Compilation commands</h4>

<p>
To compile both C and Java on Linux/Intel:
<pre>
make i686-linux
</pre>
or equivalent:
<pre>
make all ARCH=i686-linux
</pre>

<p>
To do a 'clean' on Linux/Intel:
<pre>
make clean ARCH=i686-linux
</pre>


<h4>Compiling with ALSA support</h4>

<p>
As ALSA is not installed on every Linux platform, the compilation 
of the ALSA input/output devices is defined by the make variable
<code>ENABLE_ALSA</code>. The following command must be used to
compile with ALSA support:
<pre>
make i686-linux ENABLE_ALSA=yes
</pre>


<!-- ---------------------------------------------------------------------- -->
<p>
<hr>
<a name="rpm"> <h3>Building rpms</h3></A>

<p>
<i>j</i>Max sources can be used to build rpms, in order to ease installation
and distribution on Linux platforms.

<p>
The necessary files for rpm building are included in the source rpm of <i>j</i>Max
and in the <i>j</i>Max source distribution.


<h4>Building rpms from source rpm</h4>

<p>
After installing the source rpm (<code>jMax-<i>&lt;VERSION&gt;</i>.src.rpm</code>), 
just <code>cd</code> to the rpm spec directory (usually <code>/usr/src/redhat/SPECS</code>)
and start building by:
<pre>
rpm -ba jmax.spec
</pre>



<h4>Building rpms from source distribution </h4>

<p>
This apply if you installed <i>j</i>Max sources from a .tar.gz file.

<p>
The file <code>jmax.spec</code> is in the source distribution, in
subdirectory <code>pkg/rpm/jmax.spec</code>. For rpm building, the
following files must be copied:
<ul>
<li> <code>jmax.spec</code> to the rpm spec directory, (usually <code>/usr/src/redhat/SPECS</code>)
<li> <code>jmax-<i>&lt;VERSION&gt;</i>.tar.gz</code> to the rpm sources directory, (usually <code>/usr/src/redhat/SOURCES</code>)
</ul>

<p>
After copying those files, 
just <code>cd</code> to the rpm spec directory and start building by:
<pre>
rpm -ba jmax.spec
</pre>


<!-- ---------------------------------------------------------------------- -->
<!-- ---------------------------------------------------------------------- -->
<!-- Beginning of footer                                                    -->
<!-- ---------------------------------------------------------------------- -->
<!-- ---------------------------------------------------------------------- -->

<p>
<table width=100% border=0 cellspacing=0 cellpadding=0>

<tr>
<td><spacer type="block" height="20" width="1"></td>
</tr>

<tr>
<td bgcolor="#cccccc"><spacer type="block" height="1" width="1"></td>
</tr>

<tr>
<td><spacer type="block" height="20" width="1"></td>
</tr>

<tr>
<td align=right><font size=-2>
Copyright &copy; 1995,1999 <a href="http://www.ircam.fr/">IRCAM</a>.<br>
All rights reserved.
</font></td>
</tr>

</table>

</body>
</html>
